<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Grocery List">
    <meta name="theme-color" content="#2563eb">
    <title>Family Grocery Inventory v1.0</title>
    
    <!-- PWA manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkZhbWlseSBHcm9jZXJ5IEludmVudG9yeSIsCiAgInNob3J0X25hbWUiOiAiR3JvY2VyeSIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2Y5ZmFmYiIsCiAgInRoZW1lX2NvbG9yIjogIiMyNTYzZWIiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOREFpSUdobGFXZG9kRDBpTWpRd0lqNEVORTVsVXkxQmNXSnNTa056UjNOQ1ZFSkRRVVJDUTBKRFEwSlVFeFE2STNGck5YUXRWRVZrUVZsSGQyRkVUakVnYlVWQ2RGVkxjMUl0Y21WbWMzaDZjRTU2VW5SMFlsUmthRGRYVlZacU9TSkVPZz09IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* PWA styles */
        body {
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Hide scrollbar on mobile */
        ::-webkit-scrollbar {
            display: none;
        }
        
        /* Prevent zoom on input focus */
        input[type="text"], input[type="number"], textarea {
            font-size: 16px;
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <div class="max-w-md mx-auto">
            <!-- Navigation -->
            <div class="bg-white shadow-md">
                <div class="flex">
                    <button id="inventoryTab" class="flex-1 py-4 px-4 text-center font-semibold transition-colors bg-blue-600 text-white">
                        üì¶ Inventory
                    </button>
                    <button id="orderTab" class="flex-1 py-4 px-4 text-center font-semibold transition-colors bg-white text-gray-600 hover:bg-gray-50">
                        üõí Order Sheet
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="p-4">
                <!-- Inventory View -->
                <div id="inventoryView">
                    <!-- List Header -->
                    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                        <div id="listHeader" class="flex items-center justify-between mb-4">
                            <h2 id="listTitle" class="text-xl font-bold text-gray-800">My Grocery List</h2>
                            <button id="editListBtn" class="p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                ‚úèÔ∏è
                            </button>
                        </div>
                        <div id="editListForm" class="hidden mb-4">
                            <div class="flex items-center gap-2">
                                <input type="text" id="listNameInput" class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <button id="saveListBtn" class="p-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                                    üíæ
                                </button>
                            </div>
                        </div>
                        <button id="addItemBtn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors">
                            ‚ûï Add Item
                        </button>
                    </div>

                    <!-- Add Item Form -->
                    <div id="addItemForm" class="hidden bg-white p-6 rounded-lg shadow-md mb-4">
                        <h3 class="text-lg font-semibold mb-4">Add New Item</h3>
                        <div class="space-y-4">
                            <input type="text" id="itemName" placeholder="Product name*" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <input type="text" id="itemDescription" placeholder="Description (optional)" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            
                            <!-- Photo section -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <div id="photoPreview" class="hidden relative">
                                    <img id="photoImage" class="w-full h-32 object-cover rounded-lg">
                                    <button id="removePhotoBtn" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                        ‚ùå
                                    </button>
                                </div>
                                <button id="addPhotoBtn" class="w-full flex flex-col items-center justify-center py-4 text-gray-500 hover:text-gray-700">
                                    üì∑
                                    <span class="mt-2">Add Photo</span>
                                </button>
                            </div>

                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                                    <input type="number" id="itemPrice" placeholder="0.00" step="0.01" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Needed</label>
                                    <input type="number" id="itemNeeded" placeholder="1" min="1" value="1" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">On-hand</label>
                                    <input type="number" id="itemOnHand" placeholder="0" min="0" value="0" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <button id="saveItemBtn" class="flex-1 bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 transition-colors">
                                    Add Item
                                </button>
                                <button id="cancelItemBtn" class="flex-1 bg-gray-500 text-white py-3 px-4 rounded-md hover:bg-gray-600 transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Items List -->
                    <div id="itemsList" class="space-y-3">
                        <!-- Items will be inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="text-center text-gray-500 mt-8">
                        <div class="text-6xl mb-4 opacity-50">üì¶</div>
                        <p>No items in your inventory yet.</p>
                        <p>Add some items to get started!</p>
                    </div>
                </div>

                <!-- Order View -->
                <div id="orderView" class="hidden">
                    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Weekly Order Sheet</h2>
                            <button id="resetCountsBtn" class="bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 transition-colors text-sm">
                                üîÑ Reset All Counts
                            </button>
                        </div>
                        <p class="text-gray-600">
                            Based on your current inventory, here's what you need to order:
                        </p>
                    </div>

                    <div id="orderList" class="space-y-3">
                        <!-- Order items will be inserted here -->
                    </div>

                    <div id="orderTotal" class="hidden bg-green-50 border-2 border-green-200 p-4 rounded-lg mt-4">
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-semibold text-green-800">
                                Estimated Total Cost:
                            </span>
                            <span id="totalAmount" class="text-2xl font-bold text-green-800">
                                $0.00
                            </span>
                        </div>
                    </div>

                    <div id="orderEmptyState" class="text-center text-gray-500 mt-8">
                        <div class="text-6xl mb-4 opacity-50">üõí</div>
                        <p class="text-lg font-semibold">You're all stocked up!</p>
                        <p>No items need to be ordered this week.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-4 rounded-lg max-w-sm w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Take Photo</h3>
                <button id="closeCameraBtn" class="p-2 hover:bg-gray-100 rounded">
                    ‚ùå
                </button>
            </div>
            
            <video id="cameraVideo" autoplay playsinline class="w-full rounded-lg mb-4 hidden" style="max-height: 300px;"></video>
            
            <div class="flex gap-2">
                <button id="captureBtn" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                    üì∑ Capture
                </button>
                <button id="chooseFileBtn" class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 transition-colors">
                    üìÅ Choose File
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden elements -->
    <input type="file" id="fileInput" accept="image/*" class="hidden">
    <canvas id="photoCanvas" class="hidden"></canvas>

    <script>
        // App state
        let items = [];
        let listName = 'My Grocery List';
        let currentView = 'inventory';
        let currentPhotoItemId = null;

        // Load data from localStorage
        function loadData() {
            try {
                const savedItems = localStorage.getItem('groceryItems');
                const savedListName = localStorage.getItem('groceryListName');
                if (savedItems) items = JSON.parse(savedItems);
                if (savedListName) listName = savedListName;
            } catch (error) {
                console.log('No saved data found');
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('groceryItems', JSON.stringify(items));
                localStorage.setItem('groceryListName', listName);
            } catch (error) {
                console.log('Could not save data');
            }
        }

        // Generate unique ID
        function generateId() {
            return Date.now() + Math.random();
        }

        // Switch views
        function switchView(view) {
            currentView = view;
            
            // Update tabs
            document.getElementById('inventoryTab').className = view === 'inventory' 
                ? 'flex-1 py-4 px-4 text-center font-semibold transition-colors bg-blue-600 text-white'
                : 'flex-1 py-4 px-4 text-center font-semibold transition-colors bg-white text-gray-600 hover:bg-gray-50';
            
            document.getElementById('orderTab').className = view === 'order'
                ? 'flex-1 py-4 px-4 text-center font-semibold transition-colors bg-blue-600 text-white'
                : 'flex-1 py-4 px-4 text-center font-semibold transition-colors bg-white text-gray-600 hover:bg-gray-50';
            
            // Show/hide views
            document.getElementById('inventoryView').className = view === 'inventory' ? '' : 'hidden';
            document.getElementById('orderView').className = view === 'order' ? '' : 'hidden';
            
            if (view === 'inventory') {
                renderInventory();
            } else {
                renderOrder();
            }
        }

        // Render inventory view
        function renderInventory() {
            document.getElementById('listTitle').textContent = listName;
            
            const itemsList = document.getElementById('itemsList');
            const emptyState = document.getElementById('emptyState');
            
            if (items.length === 0) {
                itemsList.innerHTML = '';
                emptyState.className = 'text-center text-gray-500 mt-8';
            } else {
                emptyState.className = 'hidden';
                itemsList.innerHTML = items.map(item => `
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <div class="flex items-start justify-between gap-3">
                            <div class="flex gap-3 flex-1">
                                ${item.photo ? `
                                    <div class="relative flex-shrink-0">
                                        <img src="${item.photo}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg border-2 border-gray-200">
                                    </div>
                                ` : ''}
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-semibold text-gray-800">${item.name}</h3>
                                    ${item.description ? `<p class="text-sm text-gray-600">${item.description}</p>` : ''}
                                    <div class="flex gap-4 text-sm text-gray-500 mt-1">
                                        <span>$${item.price.toFixed(2)}</span>
                                        <span>Weekly need: ${item.weeklyNeed}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 flex-shrink-0">
                                <button onclick="takePhoto('${item.id}')" class="p-2 rounded transition-colors ${item.photo ? 'bg-green-100 text-green-600 hover:bg-green-200' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}" title="${item.photo ? 'Update photo' : 'Add photo'}">
                                    üì∑
                                </button>
                                <div class="flex items-center gap-1 bg-gray-100 rounded-md p-1">
                                    <button onclick="updateCount('${item.id}', -1)" class="p-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                                        ‚ûñ
                                    </button>
                                    <span class="px-2 py-1 font-semibold min-w-[1.5rem] text-center text-sm">
                                        ${item.currentCount}
                                    </span>
                                    <button onclick="updateCount('${item.id}', 1)" class="p-1 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                                        ‚ûï
                                    </button>
                                </div>
                                <button onclick="deleteItem('${item.id}')" class="p-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Render order view
        function renderOrder() {
            const orderSuggestions = items.map(item => ({
                ...item,
                needToOrder: Math.max(0, item.weeklyNeed - item.currentCount)
            })).filter(item => item.needToOrder > 0);

            const orderList = document.getElementById('orderList');
            const orderTotal = document.getElementById('orderTotal');
            const orderEmptyState = document.getElementById('orderEmptyState');
            const totalAmount = document.getElementById('totalAmount');

            if (orderSuggestions.length === 0) {
                orderList.innerHTML = '';
                orderTotal.className = 'hidden';
                orderEmptyState.className = 'text-center text-gray-500 mt-8';
            } else {
                orderEmptyState.className = 'hidden';
                orderTotal.className = 'bg-green-50 border-2 border-green-200 p-4 rounded-lg mt-4';
                
                const total = orderSuggestions.reduce((sum, item) => sum + (item.price * item.needToOrder), 0);
                totalAmount.textContent = `$${total.toFixed(2)}`;

                orderList.innerHTML = orderSuggestions.map(item => `
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">${item.name}</h3>
                                ${item.description ? `<p class="text-sm text-gray-600">${item.description}</p>` : ''}
                                <div class="flex gap-4 text-sm text-gray-500 mt-1">
                                    <span>Need: ${item.weeklyNeed}</span>
                                    <span>Have: ${item.currentCount}</span>
                                    <span>Order: ${item.needToOrder}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-semibold text-green-600">
                                    $${(item.price * item.needToOrder).toFixed(2)}
                                </div>
                                <div class="text-sm text-gray-500">
                                    $${item.price.toFixed(2)} each
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Update item count
        function updateCount(itemId, change) {
            items = items.map(item => 
                item.id === itemId 
                    ? { ...item, currentCount: Math.max(0, item.currentCount + change) }
                    : item
            );
            saveData();
            renderInventory();
        }

        // Delete item
        function deleteItem(itemId) {
            items = items.filter(item => item.id !== itemId);
            saveData();
            renderInventory();
        }

        // Reset all counts
        function resetCounts() {
            items = items.map(item => ({ ...item, currentCount: 0 }));
            saveData();
            renderOrder();
        }

        // Photo functions
        function takePhoto(itemId) {
            currentPhotoItemId = itemId;
            navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } 
            }).then(stream => {
                const video = document.getElementById('cameraVideo');
                video.srcObject = stream;
                video.className = 'w-full rounded-lg mb-4';
                document.getElementById('cameraModal').className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            }).catch(err => {
                // Fallback to file input
                document.getElementById('fileInput').click();
            });
        }

        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('photoCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            const photoDataUrl = canvas.toDataURL('image/jpeg', 0.8);
            
            if (currentPhotoItemId === 'new') {
                document.getElementById('photoImage').src = photoDataUrl;
                document.getElementById('photoPreview').className = 'relative';
                document.getElementById('addPhotoBtn').className = 'hidden';
            } else {
                items = items.map(item => 
                    item.id === currentPhotoItemId 
                        ? { ...item, photo: photoDataUrl }
                        : item
                );
                saveData();
                renderInventory();
            }
            
            closeCamera();
        }

        function closeCamera() {
            const video = document.getElementById('cameraVideo');
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            document.getElementById('cameraModal').className = 'hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            currentPhotoItemId = null;
        }

        // Event listeners
        document.getElementById('inventoryTab').addEventListener('click', () => switchView('inventory'));
        document.getElementById('orderTab').addEventListener('click', () => switchView('order'));

        document.getElementById('editListBtn').addEventListener('click', () => {
            document.getElementById('listNameInput').value = listName;
            document.getElementById('listHeader').className = 'hidden';
            document.getElementById('editListForm').className = 'mb-4';
        });

        document.getElementById('saveListBtn').addEventListener('click', () => {
            listName = document.getElementById('listNameInput').value || 'My Grocery List';
            saveData();
            document.getElementById('listTitle').textContent = listName;
            document.getElementById('listHeader').className = 'flex items-center justify-between mb-4';
            document.getElementById('editListForm').className = 'hidden mb-4';
        });

        document.getElementById('addItemBtn').addEventListener('click', () => {
            document.getElementById('addItemForm').className = 'bg-white p-6 rounded-lg shadow-md mb-4';
        });

        document.getElementById('cancelItemBtn').addEventListener('click', () => {
            document.getElementById('addItemForm').className = 'hidden bg-white p-6 rounded-lg shadow-md mb-4';
            // Reset form
            document.getElementById('itemName').value = '';
            document.getElementById('itemDescription').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemNeeded').value = '1';
            document.getElementById('itemOnHand').value = '0';
            document.getElementById('photoPreview').className = 'hidden relative';
            document.getElementById('addPhotoBtn').className = 'w-full flex flex-col items-center justify-center py-4 text-gray-500 hover:text-gray-700';
        });

        document.getElementById('saveItemBtn').addEventListener('click', () => {
            const name = document.getElementById('itemName').value.trim();
            if (!name) return;

            const photo = document.getElementById('photoPreview').className.includes('hidden') 
                ? null 
                : document.getElementById('photoImage').src;

            const newItem = {
                id: generateId(),
                name: name,
                description: document.getElementById('itemDescription').value,
                price: parseFloat(document.getElementById('itemPrice').value) || 0,
                weeklyNeed: parseInt(document.getElementById('itemNeeded').value) || 1,
                currentCount: parseInt(document.getElementById('itemOnHand').value) || 0,
                photo: photo
            };

            items.push(newItem);
            saveData();
            
            // Reset and hide form
            document.getElementById('cancelItemBtn').click();
            renderInventory();
        });

        document.getElementById('addPhotoBtn').addEventListener('click', () => takePhoto('new'));
        
        document.getElementById('removePhotoBtn').addEventListener('click', () => {
            document.getElementById('photoPreview').className = 'hidden relative';
            document.getElementById('addPhotoBtn').className = 'w-full flex flex-col items-center justify-center py-4 text-gray-500 hover:text-gray-700';
        });

        document.getElementById('closeCameraBtn').addEventListener('click', closeCamera);
        document.getElementById('captureBtn').addEventListener('click', capturePhoto);
        document.getElementById('chooseFileBtn').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('resetCountsBtn').addEventListener('click', resetCounts);

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    if (currentPhotoItemId === 'new') {
                        document.getElementById('photoImage').src = event.target.result;
                        document.getElementById('photoPreview').className = 'relative';
                        document.getElementById('addPhotoBtn').className = 'hidden';
                    } else if (currentPhotoItemId) {
                        items = items.map(item => 
                            item.id === currentPhotoItemId 
                                ? { ...item, photo: event.target.result }
                                : item
                        );
                        saveData();
                        renderInventory();
                    }
                };
                reader.readAsDataURL(file);
            }
            closeCamera();
        });

        // Register service worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('data:application/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICdncm9jZXJ5LWFwcC12MSc7CmNvbnN0IFVSTFNTX1RPX0NBQ0hFID0gWwogICcuLycKXTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGV2ZW50ID0+IHsKICBldmVudC53YWl0VW50aWwoCiAgICBjYWNoZXMub3BlbihDQUNIRV9OQU1FKQogICAgICAudGhlbihjYWNoZSA9PiBjYWNoZS5hZGRBbGwoVVJMU19UT19DQUNIRSkpCiAgKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKAogICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpCiAgKTsKfSk7')
                    .then(registration => console.log('ServiceWorker registered'))
                    .catch(error => console.log('ServiceWorker registration failed'));
            });
        }

        // Initialize app
        loadData();
        switchView('inventory');
    </script>
</body>
</html>